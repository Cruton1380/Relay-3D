<!DOCTYPE html>
<html lang="en">
<head>
    <title>{title}</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/site/globals.generated.css">
    <script type="module" src="/site/dropzone/dropzone.js"></script>
    <script type="module" src="/site/modal/modal.js"></script>
    <script type="module" src="/site/movies/movie-viewer.js"></script>
    <script type="module" src="/site/movies/movie-search.js"></script>
    <script type="module" src="/site/movies/movie-upsert.js"></script>

    {head}
</head>
<body>
<article class="themed mx-auto max-w-[1320px] px-5 pb-16">
    <header class="site-header mb-4 flex-wrap">
        <div class="flex items-center gap-2 flex-1 min-w-[260px]">
            <h1 class="m-0 text-2xl font-semibold">Movie Library</h1>
        </div>
        <div class="flex items-center gap-3">
            <movie-search class="w-[360px]"></movie-search>
            <button id="open-create-modal"
                    class="px-3 py-2 rounded-md border border-black/15 bg-[color:var(--accent)] text-white whitespace-nowrap">New
                Movie
            </button>
        </div>
    </header>

    <relay-modal id="create-modal" title="Add New Movie">
        <movie-upsert></movie-upsert>
    </relay-modal>

    <div class="search-wrapper">
      <!-- optional filters could go here -->
    </div>

    <section class="movies-grid" id="movies-grid">
      <!-- Each movie card should be rendered by movie components or server insertion -->
      {body}
    </section>

</article>

<script type="module">
    // Wire the header button to open the modal
    const openBtn = document.getElementById('open-create-modal');
    const modal = document.getElementById('create-modal');
    openBtn?.addEventListener('click', () => modal?.open());
    // When upsert succeeds, close modal and ask any movie-search components to refresh
    modal?.addEventListener('movie-upsert:success', (ev) => {
        modal.close();
        document.querySelectorAll('movie-search').forEach(el => el.dispatchEvent(new CustomEvent('movie-search:refresh')));
    });
</script>
</body>
</html>