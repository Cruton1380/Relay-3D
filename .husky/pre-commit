#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Verify frontend entry chain integrity
npm run verify:entry || {
  echo ""
  echo "❌ Pre-commit check failed: Multiple entry points detected!"
  echo "Run 'npm run verify:entry' to see details."
  exit 1
}

# Enforce forbidden language lint
npm run lint:forbidden-language || {
  echo ""
  echo "❌ Pre-commit check failed: Forbidden language found!"
  echo "Update config/forbidden-language.json or remove the phrase."
  exit 1
}

# Enforce cryptographic integrity gate (CRYPTO-VERIFY-GATE-1)
npm run verify:integrity || {
  echo "[CRYPTO-GATE] pre-commit result=REFUSED overall=BROKEN"
  echo "[REFUSAL] reason=CRYPTO_GATE_PRE_COMMIT_REFUSED"
  exit 1
}
echo "[CRYPTO-GATE] pre-commit result=PASS overall=VALID"

# Enforce slice evidence gate (bypass only in explicit DRAFT mode)
npm run gate:slice || {
  echo ""
  echo "❌ Pre-commit check failed: Slice evidence gate failed!"
  echo "Ensure ACTIVE-SLICE baseline/proof/index/register are valid, or set RELAY_SLICE_MODE=DRAFT for non-canonical drafts."
  exit 1
}
